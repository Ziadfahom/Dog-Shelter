{% extends 'base.html' %}
{% load group_check %}
{% load dog_filters %}
{% load static %}
{% block content %}

    <link href="{% static 'dogs_app/css/view_dogs.css' %}" rel="stylesheet">

    <!-- Caption and Toolbar -->
    <div class="row justify-content-center caption-toolbar">
        <div class="col-12">
            <h2>Current Dogs in Our System</h2>
        </div>

        <!-- Toolbar with Add New Dog Button -->
        <div class="col-12 toolbar">
            <div class="search-filter">
                <input type="text" id="searchInput" placeholder="Search by name..." class="search-input">
                <select id="breedFilter" class="filter-select">
                    <option value="">Filter by breed</option>
                    <option value="Labrador">Labrador</option>
                    <option value="Golden Retriever">Golden Retriever</option>
                    <!-- Add other breeds here -->
                </select>
            </div>
            {% if user.is_authenticated and user|has_group:"Vet" %}
                <div class="add-dog-div">
                    <a class="btn add-dog-btn" href="{% url 'dogs_app:add_dog' %}">
                        <i class="bi bi-plus-circle-fill"></i> New Dog
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Dogs table -->
    <div class="row justify-content-center">
        <div class="table-responsive stylish-table">
            <table class="table table-striped table-hover">


                <thead class="text-center small stylish-thead">
                <tr>
                    <th scope="col" class="text-center" style="border-top-left-radius: 10px;">Dog Name</th>
                    <th scope="col" class="text-center">Arrival Date</th>
                    <th scope="col" class="text-center">Gender</th>
                    <th scope="col" class="text-center">Breed</th>
                    <th scope="col" class="text-center">Fur Color</th>
                    <th scope="col" class="text-center">Age (Years)</th>
                    <th scope="col" class="text-center">Vaccination Date</th>
                    <th scope="col" class="text-center">Neutered?</th>
                    <th scope="col" class="text-center">Dangerous?</th>
                    <th scope="col" class="text-center">Kong Added</th>
                    <th scope="col" class="text-center" style="border-top-right-radius: 10px;">Owner</th>
                </tr>
                </thead>
                <tbody class="small stylish-tbody">

                <!-- Check if there are any dogs -->
                {% if dogs %}

                    <!-- Iterate over each dog -->
                    {% for dog in dogs %}
                        <!--For each dog, a table row is created.
                        The row is clickable (redirects to the dog's record page), and hovering over it
                         shows a pointer cursor and displays a tooltip with the dog's thumbnail.-->
                        <tr class="dog-row"
                            data-href="{% url 'dogs_app:dog_record' dog.dogID %}"
                            style="cursor: pointer;"
                            data-bs-toggle="tooltip" data-bs-html="true"
                            title="{% if dog.dogImage %}<img src='{{ dog.dogImage.url }}' alt='Thumbnail of {{ dog.dogName }}' style='max-width: 200px;'>{% else %}<img src='{% static 'dogs_app/img/default_dog.jpg' %}' alt='Default dog thumbnail'>{% endif %}">
                            <td class="text-center">{{ dog.dogName|handle_none }}</td>

                            <td class="text-center">{{ dog.dateOfArrival|handle_none }}</td>
                            <td class="text-center">
                                {% if dog.gender == "M" %}
                                    Male(⚦)
                                {% elif dog.gender == "F" %}
                                    Female(⚥)
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td class="text-center">{{ dog.breed|handle_none }}</td>
                            <td class="text-center">{{ dog.furColor|handle_none }}</td>
                            <td class="text-center">{{ dog.dateOfBirthEst|calculate_age }}</td>
                            <td class="text-center">{{ dog.dateOfVaccination|handle_none }}</td>
                            <td class="text-center">
                                <div class="form-check d-flex justify-content-center">
                                    <input class="form-check-input" type="checkbox" style="transform: scale(1.5);" {% if dog.isNeutered == "Y" %}checked{% endif %} disabled>
                                </div>
                            </td>
                            <td class="text-center">
                                <div class="form-check d-flex justify-content-center">
                                    <input class="form-check-input" type="checkbox" style="transform: scale(1.5);" {% if dog.isDangerous == "Y" %}checked{% endif %} disabled>
                                </div>
                            </td>
                            <td class="text-center">{{ dog.kongDateAdded|handle_none }}</td>
                            <td class="text-center">{{ dog.owner|handle_none }}</td>
                        </tr>

                    {% endfor %}
                {% endif %}
                </tbody>
            </table>

            <!-- Paginator at the bottom of the table for pages -->
            <div class="row justify-content-center pagination-container">
                <div class="col-12">
                    <div class="pagination-wrapper">
                        <div class="pagination">
                            <span class="step-links">
                                {% if dogs.has_previous %}
                                    <a href="?page=1"><i class="fas fa-step-backward"></i> first</a>
                                    <a href="?page={{ dogs.previous_page_number }}"><i class="fas fa-arrow-left"></i> previous</a>
                                {% endif %}

                                {% for i in dogs.paginator.page_range %}
                                     {% if pagination_start <= i <= pagination_end %}
                                         {% if dogs.number == i %}
                                             <span class="current">{{ i }}</span>
                                         {% else %}
                                             <a href="?page={{ i }}">{{ i }}</a>
                                         {% endif %}
                                     {% endif %}
                                {% endfor %}

                                {% if dogs.has_next %}
                                    <a href="?page={{ dogs.next_page_number }}">next <i class="fas fa-arrow-right"></i></a>
                                    <a href="?page={{ dogs.paginator.num_pages }}">last <i class="fas fa-step-forward"></i></a>
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="{% static 'dogs_app/js/view_dogs.js' %}"></script>

{% endblock %}